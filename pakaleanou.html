<!DOCTYPE html>
<html>
<head>
    <title>Χάρτης Πακαλεάνου - Γιάννος</title>
    <style>
        html, body {
            height: 100%; /* Εξασφαλίζει ότι το body έχει ύψος για να υποστηρίξει το vh */
            margin: 0;
            padding: 0;
        }
        #map {
            height: 70vh; /* 70% του ύψους του viewport */
            width: 100%;
        }
        .table-container {
            max-height: 300px; /* Μέγιστο ύψος πίνακα, προσαρμόσιμο */
            overflow-y: auto; /* Ενεργοποίηση κάθετου scroll bar */
            width: 100%;
            position: relative;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-family: Arial, sans-serif;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 10; /* Κρατάει τις κεφαλίδες πάνω από το περιεχόμενο */
        }
        td {
            background-color: #fff; /* Εξασφαλίζει ορατότητα κειμένου */
        }
        tr:nth-child(even) td {
            background-color: #f9f9f9;
        }
        tr:hover td {
            background-color: #f5f5f5;
        }
        .highlighted td {
            background-color: #ffff99 !important;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <div class="table-container">
        <table id="locations-table">
            <thead>
                <tr>
                    <th>ΑΑ</th>
                    <th>Διεύθυνση</th>
                </tr>
            </thead>
            <tbody id="table-body"></tbody>
        </table>
    </div>
    <script>
        function initMap() {
            const map = new google.maps.Map(document.getElementById("map"), {
                zoom: 12,
                center: { lat: 38.1356291, lng: 23.8257552 } // Κέντρο στον Κρυονέρι
            });
            const locations = [
                { address: "Λεωφόρος Αγίου Σύλλα 53, Νέα Πεντέλη", title: "Λεωφόρος Αγίου Σύλλα 53, Νέα Πεντέλη", label: "1. 412827" },
                { address: "Σκουφά 52, Νέα Ερυθραία", title: "Σκουφά 52, Νέα Ερυθραία", label: "2. 403694" },
                { address: "Αυγής 12, Κηφισιά", title: "Αυγής 12, Κηφισιά", label: "3. 462667" },
                { address: "Πολυτεχνείου 19Α, Κρυονέρι", title: "Πολυτεχνείου 19Α, Κρυονέρι", label: "4. 478392" },
                { address: "Ειρήνης 17Α, Κρυονέρι", title: "Ειρήνης 17Α, Κρυονέρι", label: "5. 220378" },
                { address: "Καραϊσκάκη 8, Κρυονέρι", title: "Καραϊσκάκη 8, Κρυονέρι", label: "6. 403622" },
                { address: "Νήσων 5, Κρυονέρι", title: "Νήσων 5, Κρυονέρι", label: "7. 319376" },
                { address: "Λεωφόρος Κρυονερίου 98, Κρυονέρι", title: "Λεωφόρος Κρυονερίου 98, Κρυονέρι", label: "8. 415599" },
                { address: "Δάφνης 18-20, Κρυονέρι", title: "Δάφνης 18-20, Κρυονέρι", label: "9. 399608" },
                { address: "Παλλήνης 19Β, Κηφισιά", title: "Παλλήνης 19Β, Κηφισιά", label: "10. 400553" },
                { address: "Πρωταγόρα 7, Κηφισιά", title: "Πρωταγόρα 7, Κηφισιά", label: "11. 367472" },
                { address: "Άργους 48, Κηφισιά", title: "Άργους 48, Κηφισιά", label: "12. 36930" },
                { address: "Αγγέλου Σικελιανού 53, Κηφισιά", title: "Αγγέλου Σικελιανού 53, Κηφισιά", label: "13. 454403" },
                { address: "Πάροδος 2η Οθωνος 12, Κηφισιά", title: "Πάροδος 2η Οθωνος 12, Κηφισιά", label: "14. 303946" },
                { address: "Κέρκυρας & Εθνικής Αντιστάσεως, Νέα Ερυθραία", title: "Κέρκυρας & Εθνικής Αντιστάσεως, Νέα Ερυθραία", label: "15. 469941" }
            ];
            let currentInfoWindow = null;
            let currentMarker = null;
            const markers = [];
            // Εικονίδια πινέζας
            const defaultIcon = {
                url: "http://maps.google.com/mapfiles/ms/icons/red-dot.png",
                scaledSize: new google.maps.Size(32, 32),
                labelOrigin: new google.maps.Point(16, 40)
            };
            const enlargedIcon = {
                url: "http://maps.google.com/mapfiles/ms/icons/red-dot.png",
                scaledSize: new google.maps.Size(41.6, 41.6), // 30% μεγαλύτερο
                labelOrigin: new google.maps.Point(20.8, 52)
            };
            // Συνάρτηση για geocoding
            function geocodeAddress(address, callback) {
                const geocoder = new google.maps.Geocoder();
                geocoder.geocode({ address: address }, (results, status) => {
                    if (status === "OK") {
                        callback(results[0].geometry.location);
                    } else {
                        console.error("Geocoding failed for address " + address + ": " + status);
                        callback(null);
                    }
                });
            }
            // Προσθήκη πινέζων
            locations.forEach((location, index) => {
                if (location.address && typeof location.address === 'string') {
                    geocodeAddress(location.address, (coords) => {
                        if (coords) {
                            const marker = new google.maps.Marker({
                                position: coords,
                                map: map,
                                title: location.title,
                                label: {
                                    text: location.label,
                                    color: "black",
                                    fontSize: "14px",
                                    fontWeight: "bold"
                                },
                                icon: defaultIcon,
                                zIndex: 0 // Αρχικό zIndex
                            });
                            markers.push(marker); // Προσθήκη στον πίνακα markers
                            const infoWindow = new google.maps.InfoWindow({
                                content: `<h3>${location.title}</h3>`
                            });
                            marker.addListener("click", () => {
                                if (currentInfoWindow) {
                                    currentInfoWindow.close();
                                }
                                // Επαναφορά όλων των πινέζων
                                markers.forEach(m => {
                                    m.setIcon(defaultIcon);
                                    m.setZIndex(0);
                                });
                                // Μεγέθυνση και προσθήκη zIndex στην επιλεγμένη πινέζα
                                marker.setIcon(enlargedIcon);
                                marker.setZIndex(1000); // Φέρνει την πινέζα μπροστά
                                currentMarker = marker;
                                infoWindow.open(map, marker);
                                currentInfoWindow = infoWindow;
                                // Highlight στον πίνακα
                                document.querySelectorAll("#table-body tr").forEach(row => {
                                    row.classList.remove("highlighted");
                                });
                                const row = document.getElementById(`row-${location.label}`);
                                if (row) {
                                    row.classList.add("highlighted");
                                    // Αυτόματη κύλιση για να γίνει η σειρά ορατή
                                    row.scrollIntoView({ behavior: 'smooth', block: 'start' });
                                }
                            });
                        }
                    });
                }
            });
            // Επαναφορά με κλικ στον χάρτη (εκτός πινέζας)
            map.addListener("click", () => {
                if (currentInfoWindow) {
                    currentInfoWindow.close();
                    currentInfoWindow = null;
                }
                markers.forEach(m => {
                    m.setIcon(defaultIcon);
                    m.setZIndex(0); // Επαναφορά zIndex
                });
                currentMarker = null;
                document.querySelectorAll("#table-body tr").forEach(row => {
                    row.classList.remove("highlighted");
                });
            });
            // Συμπλήρωση του πίνακα και προσθήκη κλικ event
            const tableBody = document.getElementById("table-body");
            locations.forEach(location => {
                const row = document.createElement("tr");
                row.id = `row-${location.label}`;
                row.innerHTML = `
                    <td>${location.label}</td>
                    <td>${location.address && typeof location.address === 'string' ? location.address : 'N/A'}</td>
                `;
                row.addEventListener("click", () => {
                    // Εύρεση της αντίστοιχης πινέζας
                    const marker = markers.find(m => m.label.text === location.label);
                    if (marker) {
                        if (currentInfoWindow) {
                            currentInfoWindow.close();
                        }
                        // Επαναφορά όλων των πινέζων
                        markers.forEach(m => {
                            m.setIcon(defaultIcon);
                            m.setZIndex(0);
                        });
                        // Μεγέθυνση και προσθήκη zIndex στην επιλεγμένη πινέζα
                        marker.setIcon(enlargedIcon);
                        marker.setZIndex(1000);
                        currentMarker = marker;
                        // Άνοιγμα InfoWindow
                        const infoWindow = new google.maps.InfoWindow({
                            content: `<h3>${location.title}</h3>`
                        });
                        infoWindow.open(map, marker);
                        currentInfoWindow = infoWindow;
                        // Highlight στον πίνακα
                        document.querySelectorAll("#table-body tr").forEach(r => {
                            r.classList.remove("highlighted");
                        });
                        row.classList.add("highlighted");
                        // Κεντράρισμα χάρτη στη πινέζα
                        map.setCenter(marker.getPosition());
                    }
                });
                tableBody.appendChild(row);
            });
        }
    </script>
    <script async
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBGNEgkzo-9QKOAvy2fo7fVGSnmqviyKcM&callback=initMap">
    </script>
</body>
</html>
